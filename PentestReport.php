<?php
require_once 'PHPExcel.php';
require_once 'PHPExcel/IOFactory.php';
$objPHPExcel = new PHPExcel();
/* $objPHPExcel->getProperties()->setCreator("ThinkPHP")
				->setLastModifiedBy("Daniel Schlichtholz")
				->setTitle("Office 2007 XLSX Test Document")
				->setSubject("Office 2007 XLSX Test Document")
				->setDescription("Test doc for Office 2007 XLSX, generated by PHPExcel.")
				->setKeywords("office 2007 openxml php")
				->setCategory("Test result file");  */
//$objPHPExcel->setActiveSheetIndexByName("MyExcel.xlsx");
//$sheetIndex = $objPHPExcel->getActiveSheetIndex();				
//$objPHPExcel->removeSheetByIndex("$sheetIndex");

$objPHPExcel->getActiveSheet()->setTitle('Introduction');
$objPHPExcel->getDefaultStyle()
			->getAlignment()
			->setVERTICAL(PHPExcel_Style_Alignment::VERTICAL_TOP);
$styleArray = array(
      'borders' => array(
          'allborders' => array(
              'style' => PHPExcel_Style_Border::BORDER_THIN
          )
      )
);
$BStyle = array(
  'borders' => array(
    'outline' => array(
      'style' => PHPExcel_Style_Border::BORDER_THIN
    )
  )
);

$center = array(
        'alignment' => array(
            'horizontal' => PHPExcel_Style_Alignment::HORIZONTAL_CENTER,
        )
);

function cellColor($cells,$color){
    global $objPHPExcel;

    $objPHPExcel->getActiveSheet()->getStyle($cells)->getFill()->applyFromArray(array(
        'type' => PHPExcel_Style_Fill::FILL_SOLID,
        'startcolor' => array(
             'rgb' => $color
        )
    ));
}
cellColor('B2:Q77', 'FFFFFF');
cellColor('C7', '92D050');
cellColor('C11', '92D050');
cellColor('C16', '92D050');
cellColor('C23', '92D050');
cellColor('C29', '92D050');
cellColor('C39', '92D050');
cellColor('C43', '92D050');
cellColor('C47', '92D050');
cellColor('C53', '0D0D0D');
cellColor('E53', '0D0D0D');
cellColor('C54', '7030A0');
cellColor('C55', 'FF0000');
cellColor('C56', 'FFC000');
cellColor('C57', '92D050');
cellColor('C58', '00B0F0');

$objPHPExcel->getActiveSheet()->getStyle('B2:Q77')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle("C4")->getFont()->setBold(true)->setSize(24);
$objPHPExcel->getActiveSheet()->getStyle("C7")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C11")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C16")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C23")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C29")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C39")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C43")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C47")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C53:E53")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("C54")->getFont()->setBold(true);
$objPHPExcel->getActiveSheet()->getStyle("C55")->getFont()->setBold(true);
$objPHPExcel->getActiveSheet()->getStyle("C56")->getFont()->setBold(true);
$objPHPExcel->getActiveSheet()->getStyle("C57")->getFont()->setBold(true);
$objPHPExcel->getActiveSheet()->getStyle("C58")->getFont()->setBold(true);
$objPHPExcel->getActiveSheet()->getStyle('C7:P7')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C8:P9')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C11:P11')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C12:P14')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C16:P16')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C17:P21')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C17:P21')->getAlignment()->setWrapText(true);
$objPHPExcel->getActiveSheet()->getStyle('C23:P23')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C24:P27')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C24:P27')->getAlignment()->setWrapText(true);
$objPHPExcel->getActiveSheet()->getStyle('C29:P29')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C30:P37')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C30:P37')->getAlignment()->setWrapText(true);
$objPHPExcel->getActiveSheet()->getStyle('C39:P39')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C40:P41')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C43:P43')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C44:P45')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C47:P47')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C48:P50')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C53:D53')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C54:D54')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C55:D55')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C56:D56')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C57:D57')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C58:D58')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E53')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E54')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E55')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E56')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E57')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('E58')->applyFromArray($BStyle);
$objPHPExcel->getActiveSheet()->getStyle('C53:E53')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('C54')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('C55')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('C56')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('C57')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('C58')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->mergeCells('C7:P7');
$objPHPExcel->getActiveSheet()->mergeCells('C8:P9');
$objPHPExcel->getActiveSheet()->mergeCells('C11:P11');
$objPHPExcel->getActiveSheet()->mergeCells('C12:P14');
$objPHPExcel->getActiveSheet()->mergeCells('C16:P16');
$objPHPExcel->getActiveSheet()->mergeCells('C17:P21');
$objPHPExcel->getActiveSheet()->mergeCells('C23:P23');
$objPHPExcel->getActiveSheet()->mergeCells('C24:P27');
$objPHPExcel->getActiveSheet()->mergeCells('C29:P29');
$objPHPExcel->getActiveSheet()->mergeCells('C30:P37');
$objPHPExcel->getActiveSheet()->mergeCells('C39:P39');
$objPHPExcel->getActiveSheet()->mergeCells('C40:P41');
$objPHPExcel->getActiveSheet()->mergeCells('C43:P43');
$objPHPExcel->getActiveSheet()->mergeCells('C44:P45');
$objPHPExcel->getActiveSheet()->mergeCells('C47:P47');
$objPHPExcel->getActiveSheet()->mergeCells('C48:P50');
$objPHPExcel->getActiveSheet()->mergeCells('C52:P52');
$objPHPExcel->getActiveSheet()->mergeCells('C53:D53');
$objPHPExcel->getActiveSheet()->mergeCells('C54:D54');
$objPHPExcel->getActiveSheet()->mergeCells('C55:D55');
$objPHPExcel->getActiveSheet()->mergeCells('C56:D56');
$objPHPExcel->getActiveSheet()->mergeCells('C57:D57');
$objPHPExcel->getActiveSheet()->mergeCells('C58:D58');

$objPHPExcel->setActiveSheetIndex(0)
            ->setCellValue('C2', 'Internal Use')
            ->setCellValue('C4', 'Penetration Testing Report')
			->setCellValue('C5', 'INFOSEC, Advanced Info Service Public Company Limited')
			->setCellValue('C7', 'Project Name :')
			->setCellValue('C11', 'Version :')
			->setCellValue('C16', 'Project Detail :')
			->setCellValue('C17', 'เนื่องจากหน่วยงาน Infosec ได้มีแผนการดำเนินการตรวจสอบความปลอดภัยในส่วนของ Mobile application ของบริษัทที่ให้บริการแก่ลูกค้าและพนักงาน ตามแผนการตรวจสอประจำปี พ.ศ. 2560   ซึ่ง Mobile application มีความสำคัญในการให้บริการแก่ผู้ใช้บริการและอาจเป็นช่องทางที่ผู้ไม่ประสงค์ดีใช้ในการดำเนินการต่างๆ ที่อาจเป็นความเสี่ยงของบริษัทและผู้ใช้งาน ซึ่งอาจส่งผลกระทบกับบริษัททั้งทางตรงและทางอ้อม ดังนั้น หน่วยงาน Infosec จึงได้มีการดำเนินการความปลอดภัยเพื่อประเมินความเสี่ยงของ Mobile application และหาแนวทางในการป้องกันสำหรับ AIS Mobile application นั้นๆ ตามลักษณะให้บริการ ')
			->setCellValue('C23', 'ขอบเขตในการตรวจสอบ :')
			->setCellValue('C24', 'ขอบเขตการดำเนินการประเมินความเสี่ยงของ Mobile Application/Infrastructure และฐานข้อมูลที่ใช้สนับสนุนการทำงาน Mobile Application โดยดำเนินการประเมินช่องโหว่จาก Internet ตรวจสอบความเสี่ยงของ  Mobile application บนระบบ Android และ  iOS  ในฝั่งผู้ใช้งาน (User) และ Server ที่สามารถส่งผลกระทบและความเสียหายแก่ผู้ใช้งานเองและทาง Server')
			->setCellValue('C29', 'รูปแบบในการตรวจสอบ :')
			->setCellValue('C30', 'On – Mobile (Storage and Application) 
- ทดลองใช้งาน Mobile application ในมุมมองของ User เพื่อค้นหาจุดบกพร่องหรือช่องทางการโจมตี
- Reverse mobile application ตรวจสอบการทำ Hardcode ที่มีความสำคัญ  โดยการทำ Reverse Engineering the Application Code
- ตรวจสอบข้อมูลที่ทำการรับส่งระหว่าง ฝั่งผู้ใช้งาน (User) และ ฝั่ง Server ที่ให้บริการ
- ตรวจสอบการทำ Input validation และ Parameter ที่รับจาก User
- ตรวจสอบข้อมูที่มีการเก็บไว้ใน  Device Storage ของผู้ใช้งาน 
- อื่นๆ โดยอ้างอิงตาม OWASP Top 10 Mobile ')
			->setCellValue('C39', 'IP/URL List ที่เกี่ยวข้อง: ')
			->setCellValue('C43', 'วันดำเนินการ :')
			->setCellValue('C47', 'ผู้ดำเนินการตรวจสอบ :')
			->setCellValue('C48', 'Infosec Planning (dp-ifp@ais.co.th)')
			->setCellValue('C52', 'สรุปความเสี่ยงตามความร้ายแรงได้ดังนี้ :')
			->setCellValue('C53', 'Severity')
			->setCellValue('E53', 'Issue')
			->setCellValue('C54', 'Critical')
			->setCellValue('C55', 'High')
			->setCellValue('C56', 'Medium')
			->setCellValue('C57', 'Low')
			->setCellValue('C58', 'Info-Error');
			
$objPHPExcel->createSheet();

// Add some data to the second sheet, resembling some different data types
$objPHPExcel->setActiveSheetIndex(1)
			->setCellValue('A1', 'No.')
			->setCellValue('A2', '1')
			->setCellValue('A3', '2')
			->setCellValue('A4', '3')
			->setCellValue('A5', '4')
			->setCellValue('A6', '5')
			->setCellValue('A7', '6')
			->setCellValue('A8', '7')
			->setCellValue('A9', '8')
			->setCellValue('A10', '9')
			->setCellValue('A11', '10')
			->setCellValue('B1', 'Vulnerability Name')
			->setCellValue('C1', 'Risk Rating')
			->setCellValue('D1', 'Android')
			->setCellValue('E1', 'iOS')
			->setCellValue('F1', 'API-Backend')
			->setCellValue('H1', 'Remark');
$objPHPExcel->getActiveSheet()->setTitle('Summary Table');
cellColor('A1:AC2048', '808080');
cellColor('A1:F11', 'FFFFFF');
cellColor('H2:I2', 'FFFFFF');
cellColor('H1:I1', '4BACC6');
cellColor('A1:F1', '4BACC6');
$objPHPExcel->getActiveSheet()->getStyle("A1:I1")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(3.71);	
$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(79.71);	
$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(14.86);
$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(14.86);
$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(14.86);
$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(14.86);
$objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(8.29);
$objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(8.29);
$objPHPExcel->getActiveSheet()->getRowDimension('2')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('3')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('4')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('5')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('6')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('7')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('8')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('9')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('10')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->getRowDimension('11')->setRowHeight(30);
$objPHPExcel->getActiveSheet()->mergeCells('H1:I1');
$objPHPExcel->getActiveSheet()->getStyle('A1:F11')->applyFromArray($styleArray);
$objPHPExcel->getActiveSheet()->getStyle('H1:I2')->applyFromArray($styleArray);
$objPHPExcel->getActiveSheet()->getStyle('A1:H1')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('A2:A11')->applyFromArray($center);

$objPHPExcel->createSheet();

$objPHPExcel->setActiveSheetIndex(2);

$objPHPExcel->getActiveSheet()->setTitle('Summary Findings')
			->setCellValue('A1', 'No.')
			->setCellValue('B1', 'Vulnerability Name')
			->setCellValue('C1', 'Affected Host/Path')
			->setCellValue('D1', 'Risk')
			->setCellValue('E1', 'Observation/Implication')
			->setCellValue('F1', 'Recommendation')
			->setCellValue('G1', 'Test Evidence');
			
cellColor('A1:G1', '2E75B6');
$objPHPExcel->getActiveSheet()->getStyle("A1:G1")->getFont()->setBold(true)->getColor()->setRGB('FFFFFF');
$objPHPExcel->getActiveSheet()->getStyle("A2:G6")->getFont()->setName('Tahoma')->setSize(11);
$objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(3.71);
$objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(39.71);
$objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(37.57);
$objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(9.86);
$objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(55.71);
$objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(65.71);
$objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(16.14);
$objPHPExcel->getActiveSheet()->getRowDimension('2')->setRowHeight(100);
$objPHPExcel->getActiveSheet()->getRowDimension('3')->setRowHeight(100);
$objPHPExcel->getActiveSheet()->getRowDimension('4')->setRowHeight(100);
$objPHPExcel->getActiveSheet()->getRowDimension('5')->setRowHeight(100);
$objPHPExcel->getActiveSheet()->getRowDimension('6')->setRowHeight(100);
$objPHPExcel->getActiveSheet()->getStyle('A1:G6')->applyFromArray($styleArray);
$objPHPExcel->getActiveSheet()->getStyle('A1:G1')->applyFromArray($center);
$objPHPExcel->getActiveSheet()->getStyle('A1:AC2048')->getAlignment()->setWrapText(true);
/*
$dim = $objPHPExcel->getActiveSheet()->calculateWorksheetDimension();
        // put $start and $end array
list($start, $end) = explode(':', $dim);

if(!preg_match('#([A-Z]+)([0-9]+)#', $start, $rslt)){
            return false;
}
list($start, $start_h, $start_v) = $rslt;
*/

//$objPHPExcel2 = PHPExcel_IOFactory::load("CWE Database.xlsx");
//$objPHPExcel->getActiveSheet()->setCellValue('B2',$objPHPExcel2->getActiveSheet()->GetCell('B2')->getValue());

//$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
// If you want to output e.g. a PDF file, simply do:
//$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'PDF');
//$objWriter->save('MyExcel.xlsx');

?>

<html>
<body>

<textarea id="mytext" rows="20" cols="50">
</textarea>
<select id="dropdown">
		<option value="Missing Function Level Access Control (CWE-935)">Missing Function Level Access Control (CWE-935)</option>
		<option value="Insecure Direct Object Reference (CWE-813)">Insecure Direct Object Reference (CWE-813)</option>
		<option value="Improper Authentication (CWE-287)">Improper Authentication (CWE-287)</option>
		<option value="Session Fixation (CWE-394)">Session Fixation (CWE-394)</option>
</select>
<button onClick="openCall(); return false;">OK</button>
<button onClick="deleteValue(); return false;">Delete</button>
<button onClick="test(); return false;">test</button>

<script type="text/javascript">
    var mytextbox = document.getElementById('mytext');
    var mydropdown = document.getElementById('dropdown');
	function test() {
		var lines = mytextbox.value.split('\n');
		for(var i = 0;i < lines.length-1;i++){
			document.write(i);
		}
	}
    function openCall() {
         mytextbox.value = mytextbox.value + mydropdown.value + "\n"; //to appened
         //mytextbox.innerHTML = this.value;
    }	
	function deleteValue() {
    var data = mytextbox.value;
    mytextbox.value = mytextbox.value.replace(mydropdown.value, "");

	}
</script>
</body>
</html>
